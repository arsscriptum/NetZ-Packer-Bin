
<#
#Ì·ð“   ð“ð“¡ð“¢ ð“¢ð“’ð“¡ð“˜ð“Ÿð“£ð“¤ð“œ
#Ì·ð“   ðŸ‡µâ€‹â€‹â€‹â€‹â€‹ðŸ‡´â€‹â€‹â€‹â€‹â€‹ðŸ‡¼â€‹â€‹â€‹â€‹â€‹ðŸ‡ªâ€‹â€‹â€‹â€‹â€‹ðŸ‡·â€‹â€‹â€‹â€‹â€‹ðŸ‡¸â€‹â€‹â€‹â€‹â€‹ðŸ‡­â€‹â€‹â€‹â€‹â€‹ðŸ‡ªâ€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹ ðŸ‡¸â€‹â€‹â€‹â€‹â€‹ðŸ‡¨â€‹â€‹â€‹â€‹â€‹ðŸ‡·â€‹â€‹â€‹â€‹â€‹ðŸ‡®â€‹â€‹â€‹â€‹â€‹ðŸ‡µâ€‹â€‹â€‹â€‹â€‹ðŸ‡¹â€‹â€‹â€‹â€‹â€‹ ðŸ‡§â€‹â€‹â€‹â€‹â€‹ðŸ‡¾â€‹â€‹â€‹â€‹â€‹ ðŸ‡¬â€‹â€‹â€‹â€‹â€‹ðŸ‡ºâ€‹â€‹â€‹â€‹â€‹ðŸ‡®â€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹ðŸ‡¦â€‹â€‹â€‹â€‹â€‹ðŸ‡ºâ€‹â€‹â€‹â€‹â€‹ðŸ‡²â€‹â€‹â€‹â€‹â€‹ðŸ‡ªâ€‹â€‹â€‹â€‹â€‹ðŸ‡µâ€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹ðŸ‡¦â€‹â€‹â€‹â€‹â€‹ðŸ‡³â€‹â€‹â€‹â€‹â€‹ðŸ‡¹â€‹â€‹â€‹â€‹â€‹ðŸ‡ªâ€‹â€‹â€‹â€‹â€‹.ðŸ‡¶â€‹â€‹â€‹â€‹â€‹ðŸ‡¨â€‹â€‹â€‹â€‹â€‹@ðŸ‡¬â€‹â€‹â€‹â€‹â€‹ðŸ‡²â€‹â€‹â€‹â€‹â€‹ðŸ‡¦â€‹â€‹â€‹â€‹â€‹ðŸ‡®â€‹â€‹â€‹â€‹â€‹ðŸ‡±â€‹â€‹â€‹â€‹â€‹.ðŸ‡¨â€‹â€‹â€‹â€‹â€‹ðŸ‡´â€‹â€‹â€‹â€‹â€‹ðŸ‡²â€‹â€‹â€‹â€‹â€‹
#>

function Get-NetZExe{
    [CmdletBinding(SupportsShouldProcess)]
    param()

    try{
        $Parents = @( "F:\DEV3\COMPRESSORS\NetZ-Packer-Bin", "${ENV:ProgramFiles(x86)}\NetZ-Bin", "F:\Programs\NetZ-Bin" )
        Write-Verbose "Searching for NetZ-Bin"
        ForEach($parent in $Parents){
            Write-Verbose "  => `"$parent`""
            $folders = Get-item $parent -ea Ignore

            foreach ($folder in $folders){
                $ilmerge = Join-Path $folder 'netz.exe'
                if (Test-path -path ($ilmerge)){
                    return $ilmerge
                }
            }
        }
    }catch{
        Write-Error "$_"
    }

    return $null
}


Function Invoke-NetZ {
    [CmdletBinding(SupportsShouldProcess)]
    param(
        [ValidateScript({
            if(-Not ($_ | Test-Path) ){
                throw "Path argument: File or folder does not exist"
            }
            if(-Not ($_ | Test-Path -PathType Leaf) ){
                throw "The Path argument must be a File. Directory paths are not allowed."
            }
            return $true 
        })]
        [Parameter(Mandatory=$true,Position=0)]
        [String]$ExeFile,
        [ValidateScript({
            if(-Not ($_ | Test-Path) ){
                throw "Path argument: File or folder does not exist"
            }
            if(-Not ($_ | Test-Path -PathType Leaf) ){
                throw "The Path argument must be a File. Directory paths are not allowed."
            }
            return $true 
         })]
        [Parameter(Mandatory=$true,Position=1)]
        [String[]]$DllFiles,
        [Parameter(Mandatory=$false)]
        [String]$IconFile,
        [Parameter(Mandatory=$false)]
        [String]$OutputDir,
        [Parameter(Mandatory=$false)]
        [switch]$DllResource
    )

        $NetZExe = Get-NetZExe

        $arguments = @("-s", "`"$ExeFile`"")
        ForEach($dll in $DllFiles){
            $arguments += "$dll"
        }

        if([string]::IsNullOrEmpty($OutputDir) -eq $False){
            $arguments += "-o"
            $arguments += "`"$OutputDir`""  
        }
        if([string]::IsNullOrEmpty($IconFile) -eq $False){
            $arguments += "-i"
            $arguments += "`"$IconFile`""  
        }
        if($DllResource){
            $arguments += "-r"
        }else{
            $arguments += "-z"
        }

        Start-Process -FilePath "$NetZExe" -ArgumentsList $arguments -NoNewWindow -Wait

    }


